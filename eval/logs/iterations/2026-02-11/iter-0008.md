# Iteration 0008

- Original iteration number: 8
- Source: eval/IMPROVEMENT_PLAN.ja.md (frozen)

* Iteration: 8
* Target item: 1. SQLカタログ単体テストの改善（ZTD / Mapping）
* Change applied: P8（`eval/prompts/01_crud.md` に scope allowlist外編集禁止を明記）
* Expected effect: `scope_check`違反（`src/types/*`, `tsconfig.json` など）を抑止し、loop成功率を改善する
* Observed effect:
  - コマンド: `pnpm exec ts-node eval/loop.ts --loop 1 --scenario crud-basic --report-prefix eval/reports/loop-task1`
  - 生成物: `eval/reports/loop-task1-20260210055117-01.json`, `eval/reports/loop-task1-summary-20260210055117.json`
  - summary観測:
    - `aggregate.runner_exit_code_counts = { "0": 1 }`
    - `iterations[0].failed_categories = []`
    - `aggregate.failure_clusters = []`
  - report観測:
    - `checks.scope_check.passed = true`
    - `checks.ai_execution.meta.touchedFilesSample = ["tests/__eval_ai_marker__.txt"]`
    - `checks.ai_execution.meta.stdout_head` に read-only blocker 文言あり
* Verdict: Effective
* If Ineffective: N/A
* Proposal stack:
  - Pending:
    - P9: `ai_execution`判定を強化し、`stdout_head` に blocker/read-only 文言がある場合は fail にする。
      - 期待効果/検証: marker-only成功の偽陽性を防ぐ / `loop-task1`再実行で `ai_execution` が失敗カテゴリに出ることを確認。
    - P10: `ai_execution`に「marker以外のallowlist編集が1件以上必要」条件を追加する（marker-onlyを不合格化）。
      - 期待効果/検証: SQL/カタログ実装が無い成功を排除 / `touchedFilesSample` が marker のみなら fail になることを確認。
    - P11: `ai_execution.meta` に sandbox由来失敗フラグ（read-only等）を正規化して出力する。
      - 期待効果/検証: 失敗原因の機械集計精度向上 / summary の failure cluster に sandbox要因が一貫して出ることを確認。
  - Dropped as noise:
    - なし
  - Dropped as waste:
    - なし